{% extends "layout.html" %}
{% block content %}
<div class="report-container">
    <h2>Inspection Report</h2>
    
    <!-- Pie Chart -->
    <canvas id="inspectionChart" width="400" height="400"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('inspectionChart').getContext('2d');
        const inspectionChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Passed', 'Failed'],
                datasets: [{
                    data: [{{ passed_percentage }}, {{ failed_percentage }}],
                    backgroundColor: ['#4CAF50', '#F44336'],
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true,
                    }
                }
            }
        });
    </script>

    <!-- Defect Report -->
    <h3>Defect Report</h3>
    <ul>
        {% for defect in defects %}
            <li>{{ defect }}</li>
        {% endfor %}
    </ul>

    <!-- Print and Download Buttons -->
    <div>
        <button onclick="printReport()" class="btn btn-primary">Print Report</button>
        <button onclick="downloadReport()" class="btn btn-secondary">Download Report</button>
        <a href="{{ url_for('inspect_vehicle') }}" class="btn btn-secondary">Go Back to Inspection</a>
    </div>
</div>

<script>
    // Function to print the report
    function printReport() {
        window.print();
    }

    // Function to download the report as a PDF
    function downloadReport() {
        const element = document.querySelector('.report-container');
        html2pdf().from(element).save('inspection_report.pdf');
    }

    // Ensure you include the html2pdf.js library
    // You can include it in your layout.html or directly in this template
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</script>
{% endblock %}